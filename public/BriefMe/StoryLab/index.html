<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>StoryLab ‚Äî PatientLead+</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">üìù</text></svg>'>

  <!-- Brand tokens + Tailwind build (paths are from /public/StoryLab/) -->
    <link rel="stylesheet" href="/dist/brand.css">
    <link rel="stylesheet" href="/dist/app.css">
</head>
<body class="min-h-screen bg-lightestmint/40 text-pineygreen">
  <div class="max-w-4xl mx-auto px-4 py-6">
    <!-- Header -->
    <header class="flex items-center justify-between py-2">
      <a href="/" class="inline-flex items-center gap-3 text-pineygreen font-bold">
        <span class="w-8 h-8 rounded-lg"
              style="background: linear-gradient(135deg, var(--primary-green), var(--primary-coral));"></span>
        PatientLead+
      </a>
      <nav class="text-sm">
        <a href="/Vault/" class="hover:text-warmclay">My Vault</a>
        <span class="mx-3 opacity-40">‚Ä¢</span>
        <a href="/BriefMe/" class="hover:text-warmclay">Tools Hub</a>
      </nav>
    </header>

    <!-- Page title -->
    <section class="mt-6 mb-4">
      <h1 class="text-3xl font-bold text-pineygreen">StoryLab (MVP)</h1>
      <p class="text-sm text-pineygreen/70 mt-1">Draft a clear, provider-ready story in your own words.</p>
    </section>

    <!-- Card -->
    <main class="bg-white rounded-xl shadow-sm border border-lightestmint p-5">
      <label for="story"
             class="block text-sm font-medium text-pineygreen mb-2">What‚Äôs your story?</label>

      <textarea id="story"
                class="w-full min-h-[180px] rounded-lg border border-lightestmint focus:outline-none focus:ring-2 focus:ring-warmclay/60 p-4 text-[15px]"
                placeholder="Example: ‚ÄúHeadaches started 3 months ago after a sinus infection. Dull pressure behind my eyes most mornings‚Ä¶‚Äù"></textarea>

      <!-- helpers -->
      <div class="flex items-center justify-between mt-3 text-xs text-pineygreen/70">
        <div id="meta" aria-live="polite">0 characters ‚Ä¢ 0 words</div>
        <button id="clearBtn"
                class="text-warmclay hover:underline"
                type="button">Clear</button>
      </div>

      <!-- actions -->
      <div class="mt-5 flex flex-wrap gap-3">
        <button id="outlineBtn"
                class="px-4 py-2 rounded-lg text-white bg-softsage hover:bg-pineygreen transition"
                type="button">Generate outline (local)</button>

        <button id="copyBtn"
                class="px-4 py-2 rounded-lg border border-lightestmint hover:border-softsage text-pineygreen"
                type="button">Copy text</button>

        <button id="saveBtn"
                class="ml-auto px-4 py-2 rounded-lg border border-lightestmint hover:border-softsage text-pineygreen"
                type="button">Save draft</button>
      </div>

      <!-- simple preview -->
      <div class="mt-6">
        <h2 class="text-sm font-semibold text-pineygreen mb-2">Quick outline</h2>
        <div id="outline"
             class="text-sm bg-lightestmint/60 border border-lightestmint rounded-lg p-4 min-h-[80px] whitespace-pre-wrap"></div>
      </div>
    </main>

    <footer class="text-center text-xs text-pineygreen/60 mt-8">
      üîí Drafts are stored locally on this device. You can move cloud save into the Vault later.
    </footer>
  </div>

  <!-- Minimal local-only logic -->
  <script type="module">
    const el = {
      story: document.getElementById('story'),
      meta: document.getElementById('meta'),
      outline: document.getElementById('outline'),
      clearBtn: document.getElementById('clearBtn'),
      outlineBtn: document.getElementById('outlineBtn'),
      copyBtn: document.getElementById('copyBtn'),
      saveBtn: document.getElementById('saveBtn')
    };

    const KEY = 'storylab_draft_v1';

    // restore draft
    try {
      const saved = localStorage.getItem(KEY);
      if (saved) el.story.value = saved;
    } catch {}

    function updateMeta() {
      const text = el.story.value.trim();
      const chars = text.length;
      const words = text ? text.split(/\s+/).length : 0;
      el.meta.textContent = `${chars} characters ‚Ä¢ ${words} words`;
    }

    function toOutline(text) {
      if (!text) return '';
      // ultra-simple heuristic: split on sentences or newlines
      const parts = text
        .split(/\n+|(?<=[.!?])\s+/)
        .map(s => s.trim())
        .filter(Boolean)
        .slice(0, 8);
      return parts.map((p, i) => `‚Ä¢ ${p}`).join('\n');
    }

    // live meta + autosave lite
    el.story.addEventListener('input', () => {
      updateMeta();
      // lightweight debounce save
      clearTimeout(el._t);
      el._t = setTimeout(() => {
        try { localStorage.setItem(KEY, el.story.value); } catch {}
      }, 400);
    });

    el.clearBtn.addEventListener('click', () => {
      el.story.value = '';
      el.outline.textContent = '';
      updateMeta();
      try { localStorage.removeItem(KEY); } catch {}
    });

    el.outlineBtn.addEventListener('click', () => {
      el.outline.textContent = toOutline(el.story.value);
    });

    el.copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(el.story.value);
        el.copyBtn.textContent = 'Copied!';
        setTimeout(() => (el.copyBtn.textContent = 'Copy text'), 1200);
      } catch {}
    });

    el.saveBtn.addEventListener('click', () => {
      try {
        localStorage.setItem(KEY, el.story.value);
        el.saveBtn.textContent = 'Saved ‚úì';
        setTimeout(() => (el.saveBtn.textContent = 'Save draft'), 1200);
      } catch {}
    });

    // initial
    updateMeta();
  </script>
</body>
</html>
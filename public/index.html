<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PatientLead+ ‚Äî Your Healthcare Advocacy Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- inline emoji favicon -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">‚ûï</text></svg>'>
  <!-- Roboto -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand-light:#ebf0eb;
      --brand-dark:#3c5c5e;
      --brand-green:#a3b9a3;
      --brand-coral:#c97f6d;
      --line:#dddddd;
      --card:#ffffff;
      --muted:#666;
      --shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    *{box-sizing:border-box}
    body{
      font-family: 'Roboto', system-ui, -apple-system, Segoe UI, sans-serif;
      background: linear-gradient(135deg, var(--brand-light) 0%, #ffffff 100%);
      color: var(--brand-dark);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .container{
      max-width: 1120px;
      margin: 0 auto;
      padding: 20px;
    }
    header{
      display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:32px;padding-top:20px;
    }
    .logo{
      display:flex;align-items:center;gap:12px;font-weight:700;font-size:24px;color:var(--brand-dark);
    }
    .logo-badge{
      width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--brand-green),var(--brand-coral));
      box-shadow: 0 2px 8px rgba(169,124,109,0.3);
    }
    nav a{
      color:var(--brand-dark);text-decoration:none;margin-left:20px;font-weight:500;
      transition: color 0.2s ease;
    }
    nav a:hover{color:var(--brand-coral)}
    
    /* Hero Section */
    .hero{
      text-align:center;margin:48px 0;
    }
    .hero h1{
      font-size:36px;margin:0 0 12px;color:var(--brand-dark);
      font-weight:700;
    }
    .hero .tagline{
      font-size:18px;color:var(--muted);margin:0 0 40px;
      max-width:600px;margin-left:auto;margin-right:auto;
    }
    .journey-timeline {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin: 40px 0;
  position: relative;
}

.timeline-card {
  background: white;
  border-radius: 16px;
  padding: 24px;
  position: relative;
  transition: all 0.3s ease;
  border: 2px solid transparent;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.timeline-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  border-color: var(--brand-green);
}

.timeline-icon {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, var(--brand-green), var(--brand-coral));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  margin-bottom: 16px;
}

.timeline-phase {
  font-size: 18px;
  font-weight: 600;
  color: var(--brand-dark);
  margin-bottom: 12px;
}

.timeline-content {
  font-size: 14px;
  line-height: 1.6;
  color: var(--muted);
}

/* Add connecting line on desktop */
@media (min-width: 768px) {
  .journey-timeline::before {
    content: '';
    position: absolute;
    top: 40px;
    left: 10%;
    right: 10%;
    height: 2px;
    background: linear-gradient(90deg, var(--brand-green), var(--brand-coral));
    z-index: -1;
  }
  /* Accessibility - visually hidden but screen reader accessible */
.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Input section improvements */
.input-subtitle {
  font-size: 16px;
  color: var(--muted);
  margin: -10px 0 24px;
  text-align: center;
}

/* Suggestion pills */
.suggestion-pills {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 16px 0;
  justify-content: center;
}

.pill {
  padding: 8px 16px;
  background: white;
  border: 1px solid var(--line);
  border-radius: 999px;
  font-size: 14px;
  color: var(--brand-dark);
  cursor: pointer;
  transition: all 0.2s ease;
  font-family: inherit;
}

.pill:hover {
  background: var(--brand-green);
  color: white;
  border-color: var(--brand-green);
  transform: translateY(-1px);
}

.pill:focus {
  outline: 2px solid var(--brand-coral);
  outline-offset: 2px;
}

/* Ecosystem summary */
.ecosystem-summary {
  text-align: center;
  font-size: 14px;
  color: var(--muted);
  margin: 20px 0 12px;
  line-height: 1.5;
}

/* Data practices link */
.data-practices {
  text-align: center;
  font-size: 13px;
  color: var(--muted);
  margin: 12px 0 0;
}

.data-practices a {
  color: var(--brand-dark);
  text-decoration: none;
  border-bottom: 1px dotted var(--brand-dark);
  transition: color 0.2s ease;
}

.data-practices a:hover {
  color: var(--brand-coral);
  border-bottom-color: var(--brand-coral);
}

/* Routing feedback */
.routing-feedback {
  margin-top: 20px;
  padding: 16px;
  background: var(--brand-light);
  border-radius: 12px;
  border: 1px solid var(--brand-green);
  display: none;
  animation: slideDown 0.3s ease;
}

.routing-feedback.active {
  display: block;
}

.routing-feedback h3 {
  margin: 0 0 8px;
  font-size: 16px;
  color: var(--brand-dark);
}

.routing-feedback p {
  margin: 0;
  font-size: 14px;
  color: var(--muted);
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Better contrast for accessibility */
.submit-btn {
  background: var(--brand-dark);
  font-weight: 600;
}

.submit-btn:hover {
  background: #2a4446;
}

/* Focus styles for keyboard navigation */
.input-field:focus,
.dropdown-select:focus,
button:focus {
  outline: 2px solid var(--brand-coral);
  outline-offset: 2px;
}

/* Mobile optimizations */
@media (max-width: 640px) {
  .input-section {
    padding: 24px 16px;
  }
  
  .suggestion-pills {
    gap: 6px;
  }
  
  .pill {
    padding: 6px 12px;
    font-size: 13px;
  }
  
  .input-field {
    font-size: 16px; /* Prevents zoom on iOS */
  }
}

/* Landscape mobile */
@media (max-height: 500px) {
  .hero {
    margin: 24px 0;
  }
  
  .hero h1 {
    font-size: 28px;
  }
  
  .input-section {
    padding: 20px;
  }
}

/* Ultra-narrow screens */
@media (max-width: 320px) {
  .container {
    padding: 12px;
  }
  
  .pill {
    flex: 1 1 45%;
    text-align: center;
  }
}
}

.hero-description {
  animation: fadeInUp 0.6s ease-out 0.3s both;
}
    
    /* Natural Language Input Section */
    .input-section{
      background:var(--card);
      border-radius:16px;
      padding:32px;
      box-shadow:var(--shadow);
      margin-bottom:32px;
      border:1px solid var(--line);
    }
    .input-label{
      font-size:22px;
      font-weight:500;
      color:var(--brand-dark);
      margin-bottom:20px;
      text-align:center;
    }
    .input-wrapper{
      max-width:700px;
      margin:0 auto;
    }
    .input-field{
      width:100%;
      padding:16px 20px;
      font-size:16px;
      border:2px solid var(--line);
      border-radius:12px;
      font-family:inherit;
      transition:border-color 0.2s ease;
      background:#fff;
    }
    .input-field:focus{
      outline:none;
      border-color:var(--brand-green);
    }
    .input-or{
      text-align:center;
      margin:20px 0;
      color:var(--muted);
      font-size:14px;
    }
    .dropdown-wrapper{
      position:relative;
    }
    .dropdown-select{
      width:100%;
      padding:16px 20px;
      font-size:16px;
      border:2px solid var(--line);
      border-radius:12px;
      font-family:inherit;
      background:#fff;
      cursor:pointer;
      appearance:none;
      background-image: url('data:image/svg+xml;utf8,<svg fill="%233c5c5e" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
      background-repeat:no-repeat;
      background-position:right 12px center;
      padding-right:48px;
    }
    .submit-btn{
      width:100%;
      padding:16px;
      margin-top:20px;
      background:linear-gradient(135deg,var(--brand-green),var(--brand-coral));
      color:#fff;
      border:none;
      border-radius:12px;
      font-size:18px;
      font-weight:500;
      cursor:pointer;
      transition:transform 0.2s ease, box-shadow 0.2s ease;
    }
    .submit-btn:hover{
      transform:translateY(-2px);
      box-shadow:0 4px 16px rgba(169,124,109,0.3);
    }
    
    /* Quick Actions */
    .quick-actions{
      margin:40px 0;
    }
    .section-title{
      font-size:24px;
      font-weight:500;
      color:var(--brand-dark);
      margin-bottom:20px;
      text-align:center;
    }
    .action-grid{
      display:grid;
      gap:20px;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    }
    .action-card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:12px;
      padding:20px;
      transition:all 0.3s ease;
      cursor:pointer;
      position:relative;
      overflow:hidden;
    }
    .action-card::before{
      content:'';
      position:absolute;
      top:0;left:0;right:0;
      height:4px;
      background:linear-gradient(90deg,var(--brand-green),var(--brand-coral));
      transform:scaleX(0);
      transition:transform 0.3s ease;
    }
    .action-card:hover{
      box-shadow:var(--shadow);
      transform:translateY(-2px);
    }
    .action-card:hover::before{
      transform:scaleX(1);
    }
    .action-icon{
      width:48px;height:48px;
      background:linear-gradient(135deg,var(--brand-green),var(--brand-coral));
      border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      font-size:24px;
      margin-bottom:12px;
    }
    .action-title{
      font-size:18px;
      font-weight:500;
      color:var(--brand-dark);
      margin-bottom:8px;
    }
    .action-desc{
      font-size:14px;
      color:var(--muted);
      line-height:1.5;
    }
    .action-tags{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .tag{
      padding:4px 10px;
      background:var(--brand-light);
      color:var(--brand-dark);
      border-radius:999px;
      font-size:12px;
    }
    
    /* Ecosystem Overview */
    .ecosystem{
      margin:48px 0;
    }
    .ecosystem-toggle{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:12px;
      padding:20px;
      cursor:pointer;
      transition:all 0.3s ease;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .ecosystem-toggle:hover{
      box-shadow:var(--shadow);
    }
    .ecosystem-title{
      display:flex;
      align-items:center;
      gap:12px;
      font-size:20px;
      font-weight:500;
      color:var(--brand-dark);
    }
    .ecosystem-arrow{
      transition:transform 0.3s ease;
      color:var(--brand-coral);
    }
    .ecosystem-toggle.open .ecosystem-arrow{
      transform:rotate(180deg);
    }
    .ecosystem-content{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:12px;
      margin-top:20px;
      padding:32px;
      display:none;
    }
    .ecosystem-content.open{
      display:block;
    }
    .ecosystem-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:24px;
      margin-top:24px;
    }
    .eco-card{
      text-align:center;
    }
    .eco-icon{
      width:64px;height:64px;
      margin:0 auto 16px;
      background:linear-gradient(135deg,var(--brand-green),var(--brand-coral));
      border-radius:16px;
      display:flex;align-items:center;justify-content:center;
      font-size:32px;
    }
    .eco-title{
      font-size:18px;
      font-weight:500;
      color:var(--brand-dark);
      margin-bottom:8px;
    }
    .eco-desc{
      font-size:14px;
      color:var(--muted);
      line-height:1.5;
    }
    
    /* Dynamic Suggestions */
    .suggestions{
      display:none;
      margin:32px 0;
    }
    .suggestions.active{
      display:block;
    }
    .suggestions-title{
      font-size:20px;
      font-weight:500;
      color:var(--brand-dark);
      margin-bottom:16px;
    }
    .suggestion-list{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .suggestion-item{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:12px;
      padding:16px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      cursor:pointer;
      transition:all 0.2s ease;
    }
    .suggestion-item:hover{
      box-shadow:var(--shadow);
      border-color:var(--brand-green);
    }
    .suggestion-text{
      flex:1;
    }
    .suggestion-name{
      font-weight:500;
      color:var(--brand-dark);
      margin-bottom:4px;
    }
    .suggestion-desc{
      font-size:14px;
      color:var(--muted);
    }
    .suggestion-arrow{
      color:var(--brand-coral);
      font-size:20px;
    }
    
    footer{
      margin:60px 0 40px;
      padding-top:32px;
      border-top:1px solid var(--line);
      text-align:center;
      color:var(--muted);
      font-size:14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="logo-badge" aria-hidden="true"></div>
        PatientLead+
      </div>
      <nav>
        <a href="/Vault/">My Vault</a>
        <a href="/BriefMe/">Tools Hub</a>
      </nav>
    </header>

<!-- Hero Section -->
<div class="hero">
  <h1>Your Healthcare Advocacy Platform</h1>
  <p class="tagline">Smart tools to prepare for visits, track symptoms, understand your rights, and communicate effectively with providers.</p>
  
  <!-- Add this new section -->
<!-- Patient Journey Timeline -->
<div class="journey-timeline">
  <div class="timeline-card" data-phase="before">
    <div class="timeline-icon">üìã</div>
    <div class="timeline-phase">Before Your Visit</div>
    <div class="timeline-content">
      Transforms scattered symptoms and tangled histories into clear, provider-ready narratives, revealing patterns that might otherwise go unnoticed.
    </div>
  </div>
  
  <div class="timeline-card" data-phase="during">
    <div class="timeline-icon">üí¨</div>
    <div class="timeline-phase">During Conversations</div>
    <div class="timeline-content">
      Real-time coaching helps craft precise questions and navigate difficult moments, offering strategic responses when providers dismiss concerns.
    </div>
  </div>
  
  <div class="timeline-card" data-phase="after">
    <div class="timeline-icon">üìà</div>
    <div class="timeline-phase">After Your Visit</div>
    <div class="timeline-content">
      Streamlines insurance appeals, clarifies patient rights, and removes access barriers. Connects you with compatible providers and supportive peers.
    </div>
  </div>
  
  <div class="timeline-card" data-phase="always">
    <div class="timeline-icon">üîí</div>
    <div class="timeline-phase">Always Learning</div>
    <div class="timeline-content">
      Every interaction is securely stored in your vault, creating a comprehensive health story that grows more powerful over time.
    </div>
  </div>
</div>

<!-- Natural Language Input -->
<div class="input-section">
  <h2 class="input-label">What do you want to do today?</h2>
  <p class="input-subtitle">Type it in your own words, or pick a suggestion.</p>
  
  <div class="input-wrapper">
    <label for="userInput" class="visually-hidden">Describe what you need help with</label>
    <input 
      type="text" 
      id="userInput" 
      class="input-field" 
      placeholder="e.g., 'prepare for a neurology visit' or 'summarize my headache history'"
      aria-describedby="input-suggestions"
      autofocus
    />
    
    <!-- Suggested task pills -->
    <div id="input-suggestions" class="suggestion-pills" role="list">
      <button type="button" class="pill" data-suggestion="prep">Prep for a visit</button>
      <button type="button" class="pill" data-suggestion="symptoms">Summarize symptoms</button>
      <button type="button" class="pill" data-suggestion="questions">Draft questions</button>
      <button type="button" class="pill" data-suggestion="appeal">Check insurance appeal</button>
      <button type="button" class="pill" data-suggestion="provider">Find a provider</button>
      <button type="button" class="pill" data-suggestion="translate">Translate & simplify notes</button>
      <button type="button" class="pill" data-suggestion="rights">Know my rights</button>
      <button type="button" class="pill" data-suggestion="track">Track patterns</button>
    </div>
    
    <button id="goBtn" class="submit-btn" aria-label="Get started with your healthcare task">
      Get Started ‚Üí
    </button>
    
    <!-- One-line ecosystem summary -->
    <p class="ecosystem-summary">
      This workspace helps you prepare for visits, communicate effectively during appointments, and manage follow-ups with confidence.
    </p>
    
    <!-- Data practices link -->
    <p class="data-practices">
      üîí Your data stays private. <a href="/data-practices" aria-label="Learn about our data practices">What happens with my data?</a>
    </p>
  </div>
  
  <!-- Result routing feedback -->
  <div id="routing-feedback" class="routing-feedback" role="status" aria-live="polite"></div>
</div>

    <!-- Dynamic Suggestions (hidden by default) -->
    <div id="suggestions" class="suggestions">
      <div class="suggestions-title">Recommended tools for you:</div>
      <div id="suggestionsList" class="suggestion-list"></div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h2 class="section-title">Popular Tools</h2>
      <div class="action-grid">
        <div class="action-card" data-goal="visit_prep">
          <div class="action-icon">üìã</div>
          <div class="action-title">Visit Preparation</div>
          <div class="action-desc">Set goals, organize questions, and create an agenda for productive appointments.</div>
          <div class="action-tags">
            <span class="tag">Agenda</span>
            <span class="tag">Questions</span>
            <span class="tag">Goals</span>
          </div>
        </div>

        <div class="action-card" data-goal="symptom_summary">
          <div class="action-icon">üìù</div>
          <div class="action-title">Symptom Documentation</div>
          <div class="action-desc">Create clear, provider-ready summaries using the OLD CARTS framework.</div>
          <div class="action-tags">
            <span class="tag">OLD CARTS</span>
            <span class="tag">Timeline</span>
            <span class="tag">Shareable</span>
          </div>
        </div>

        <div class="action-card" data-goal="appeal">
          <div class="action-icon">‚úâÔ∏è</div>
          <div class="action-title">Insurance Appeals</div>
          <div class="action-desc">Draft evidence-based appeals with proper deadlines and documentation.</div>
          <div class="action-tags">
            <span class="tag">Appeals</span>
            <span class="tag">Evidence</span>
            <span class="tag">Deadlines</span>
          </div>
        </div>

        <div class="action-card" data-goal="rights">
          <div class="action-icon">‚öñÔ∏è</div>
          <div class="action-title">Know Your Rights</div>
          <div class="action-desc">Understand healthcare laws, patient rights, and advocacy options.</div>
          <div class="action-tags">
            <span class="tag">Rights</span>
            <span class="tag">Legal</span>
            <span class="tag">Advocacy</span>
          </div>
        </div>

        <div class="action-card" data-goal="trend_track">
          <div class="action-icon">üìä</div>
          <div class="action-title">Pattern Tracking</div>
          <div class="action-desc">Identify triggers, cycles, and trends in your symptoms over time.</div>
          <div class="action-tags">
            <span class="tag">Analytics</span>
            <span class="tag">Trends</span>
            <span class="tag">Charts</span>
          </div>
        </div>

        <div class="action-card" data-goal="conversation_practice">
          <div class="action-icon">üí¨</div>
          <div class="action-title">Communication Practice</div>
          <div class="action-desc">Role-play difficult conversations and get real-time coaching.</div>
          <div class="action-tags">
            <span class="tag">Practice</span>
            <span class="tag">Scripts</span>
            <span class="tag">Coaching</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Ecosystem Overview -->
    <div class="ecosystem">
      <div id="ecosystemToggle" class="ecosystem-toggle">
        <div class="ecosystem-title">
          <span>üîç</span>
          <span>How PatientLead+ Works</span>
        </div>
        <div class="ecosystem-arrow">‚ñº</div>
      </div>
      <div id="ecosystemContent" class="ecosystem-content">
        <p style="text-align:center;color:var(--muted);margin-bottom:32px;">
          A complete ecosystem designed to empower patients through every step of their healthcare journey.
        </p>
        <div class="ecosystem-grid">
          <div class="eco-card">
            <div class="eco-icon">üõ†Ô∏è</div>
            <div class="eco-title">Smart Tools Layer</div>
            <div class="eco-desc">
              20+ specialized tools for communication, documentation, appeals, symptom tracking, and advocacy. Each tool solves a specific healthcare challenge.
            </div>
          </div>
          <div class="eco-card">
            <div class="eco-icon">üîí</div>
            <div class="eco-title">Medical Memory Vault</div>
            <div class="eco-desc">
              Secure central storage for all your healthcare data. Information flows seamlessly between tools, creating a complete health timeline.
            </div>
          </div>
          <div class="eco-card">
            <div class="eco-icon">ü§ñ</div>
            <div class="eco-title">CoPilot Intelligence</div>
            <div class="eco-desc">
              AI-powered insights that learn your patterns, suggest next steps, and help you navigate complex healthcare situations effectively.
            </div>
          </div>
          <div class="eco-card">
            <div class="eco-icon">üè•</div>
            <div class="eco-title">HIPAA-Ready Backend</div>
            <div class="eco-desc">
              Enterprise-grade security with Firebase + Google Cloud. Your data is encrypted, private, and compliant with healthcare standards.
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>PatientLead+ ‚Äî Empowering patients with smart healthcare advocacy tools</p>
      <p style="margin-top:8px;font-size:12px;">Built with Firebase ‚Ä¢ Powered by Anthropic Claude ‚Ä¢ HIPAA-ready infrastructure</p>
    </footer>
  </div>

  <!-- Auto-init CoPilot + global helpers -->
  <script type="module" src="/lib/briefmeAuto.js"></script>

  <!-- Smart router logic -->
  <script type="module">
    // Wait for briefmeAuto to initialize
    const bm = window.briefme || {};

    // Tool mapping with metadata
    const toolMap = {
      visit_prep: { 
        url: "/BriefMe/AgendaDesigner/", 
        name: "Agenda Designer",
        desc: "Structure your visit with clear objectives and talking points"
      },
      symptom_summary: { 
        url: "/SymptomPro/", 
        name: "SymptomPro",
        desc: "Create provider-ready symptom summaries using OLD CARTS"
      },
      appeal: { 
        url: "/AppealBuilder/", 
        name: "Appeal Builder",
        desc: "Generate evidence-based insurance appeals with deadlines"
      },
      rights: { 
        url: "/RightsBuilder/", 
        name: "Rights Builder",
        desc: "Understand your healthcare rights and next steps"
      },
      peers: { 
        url: "/PeerMatch/", 
        name: "Peer Match",
        desc: "Connect with others who share similar conditions"
      },
      providers: { 
        url: "/ProviderMatch/", 
        name: "Provider Match",
        desc: "Find compatible providers based on your needs"
      },
      trend_track: { 
        url: "/TrendTrack/", 
        name: "Trend Track",
        desc: "Analyze symptom patterns and identify triggers"
      },
      conversation_practice: { 
        url: "/PromptCoach/", 
        name: "Prompt Coach",
        desc: "Practice difficult conversations with real-time coaching"
      },
      review_notes: { 
        url: "/ResetPro/", 
        name: "Reset Pro",
        desc: "Analyze provider messages and plan responses"
      },
      second_opinion: { 
        url: "/BriefMe/ResumeBuilder/", 
        name: "Resume Builder",
        desc: "Create a comprehensive medical summary for new providers"
      }
    };

    // Natural language to intent mapping
    function parseIntent(text) {
      const lower = text.toLowerCase();
      
      // Keywords mapping
      const patterns = {
        visit_prep: /prepare|appointment|visit|agenda|meeting|doctor/,
        symptom_summary: /symptom|pain|old carts|describe|document/,
        appeal: /appeal|insurance|denied|coverage|rejection/,
        rights: /rights|legal|law|discrimination|ada/,
        trend_track: /track|pattern|trend|analyze|trigger|cycle/,
        conversation_practice: /practice|conversation|talk|communicate|script/,
        peers: /peer|support|community|others|similar/,
        providers: /provider|doctor|specialist|find|match/,
        review_notes: /review|notes|message|portal|response/,
        second_opinion: /second opinion|new doctor|summary|history|resume/
      };

      for (const [intent, pattern] of Object.entries(patterns)) {
        if (pattern.test(lower)) return intent;
      }
      
      return "visit_prep"; // default
    }
      
      // Clear previous
      listEl.innerHTML = '';
      
      // Build suggestions based on intent
      const primary = toolMap[intent];
      const related = getRelatedTools(intent);
      
      // Add primary suggestion
      if (primary) {
        const item = createSuggestionItem(primary, intent, true);
        listEl.appendChild(item);
      }
      
      // Add related tools
      related.forEach(([key, tool]) => {
        const item = createSuggestionItem(tool, key, false);
        listEl.appendChild(item);
      });
      
      suggestionsEl.classList.add('active');
    }

    // Route to tool
    function go(intent, freeText = "") {
      const tool = toolMap[intent] || toolMap.visit_prep;
      const handoff = {
        intent,
        notes: freeText,
        chiefComplaint: freeText,
        contextNotes: freeText
      };

      // CoPilot telemetry
      try {
        window.briefme?.registerCopilotIngest?.({ enabled: true, defaultTool: "smart_start" });
        window.briefme?.copilot?.ingest?.("route", "smart_start", { intent, hasText: !!freeText });
      } catch {}

      // Handoff + navigate
      try {
        window.briefme?.setGlobalHandoff?.(handoff);
      } catch {}
      
      const url = new URL(tool.url, location.origin);
      url.searchParams.set("from", "smart_start");
      location.href = url.toString();
    }

    // Expose for potential future use
    window.briefme = window.briefme || {};
    window.briefme.routeToTool = ({ userText, selectedOption }) => {
      const intent = selectedOption || parseIntent(userText || "");
      go(intent, userText);
    };

  // Pill suggestions mapping
const pillMap = {
  prep: { intent: 'visit_prep', text: 'prepare for appointment' },
  symptoms: { intent: 'symptom_summary', text: 'summarize symptoms' },
  questions: { intent: 'conversation_practice', text: 'draft questions' },
  appeal: { intent: 'appeal', text: 'check insurance appeal' },
  provider: { intent: 'providers', text: 'find a provider' },
  translate: { intent: 'review_notes', text: 'translate and simplify notes' },
  rights: { intent: 'rights', text: 'know my rights' },
  track: { intent: 'trend_track', text: 'track symptom patterns' }
};

// Handle pill clicks
document.querySelectorAll('.pill').forEach(pill => {
  pill.addEventListener('click', (e) => {
    const suggestion = e.target.dataset.suggestion;
    const mapped = pillMap[suggestion];
    if (mapped) {
      document.getElementById('userInput').value = mapped.text;
      showRoutingFeedback(mapped.intent, mapped.text);
    }
  });
});

// Show routing feedback before navigation
function showRoutingFeedback(intent, text) {
  const feedback = document.getElementById('routing-feedback');
  const tool = toolMap[intent];
  
  if (!tool) return;
  
  // Build feedback message
  const messages = {
    visit_prep: "We'll help you create an agenda and organize your questions, then save it to your Vault.",
    symptom_summary: "We'll create a provider-ready symptom summary using the OLD CARTS framework.",
    appeal: "We'll draft an evidence-based insurance appeal with proper deadlines and documentation.",
    rights: "We'll clarify your healthcare rights and suggest actionable next steps.",
    trend_track: "We'll analyze your symptom patterns and identify potential triggers.",
    conversation_practice: "We'll help you practice difficult conversations with real-time coaching.",
    providers: "We'll match you with compatible providers based on your needs.",
    review_notes: "We'll analyze provider messages and help you plan effective responses."
  };
  
  feedback.innerHTML = `
    <h3>Taking you to: ${tool.name}</h3>
    <p>${messages[intent] || tool.desc}</p>
  `;
  
  feedback.classList.add('active');
  
  // Navigate after brief delay
  setTimeout(() => {
    go(intent, text);
  }, 1500);
}

// Update the main button handler
document.getElementById('goBtn').addEventListener('click', () => {
  const text = document.getElementById('userInput').value.trim();
  
  if (text) {
    const intent = parseIntent(text);
    showRoutingFeedback(intent, text);
  } else {
    // Focus input if empty
    document.getElementById('userInput').focus();
  }
});

// Enter key triggers primary action
document.getElementById('userInput').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    document.getElementById('goBtn').click();
  }
});

// Auto-focus on page load
window.addEventListener('load', () => {
  document.getElementById('userInput').focus();
});

    // Quick action cards
    document.querySelectorAll('[data-goal]').forEach(card => {
      card.addEventListener('click', (e) => {
        const intent = e.currentTarget.getAttribute('data-goal');
        go(intent, "");
      });
    });

    // Ecosystem toggle
    document.getElementById('ecosystemToggle').addEventListener('click', () => {
      const toggle = document.getElementById('ecosystemToggle');
      const content = document.getElementById('ecosystemContent');
      toggle.classList.toggle('open');
      content.classList.toggle('open');
    });

    // Clear dropdown when typing
    document.getElementById('userInput').addEventListener('input', () => {
      document.getElementById('taskSelect').value = '';
    });

    // Clear text when selecting dropdown
    document.getElementById('taskSelect').addEventListener('change', () => {
      if (document.getElementById('taskSelect').value) {
        document.getElementById('userInput').value = '';
      }
    });
  </script>
</body>
</html>
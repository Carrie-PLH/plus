<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PatientLead+ Smart Start</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font:16px/1.5 system-ui, sans-serif; max-width:640px; margin:40px auto; padding:0 20px; color:#222; }
    h1 { margin-bottom:8px; }
    p { margin:0 0 18px; color:#444; }
    .goals { display:flex; flex-direction:column; gap:12px; }
    button {
      padding:12px; border:none; border-radius:8px;
      background:#0a66c2; color:#fff; font:inherit; cursor:pointer; text-align:left;
    }
    button:hover { background:#004080; }
    small.hint { display:block; margin-top:8px; color:#666; }
  </style>
</head>
<body>
  <h1>What do you want to do today?</h1>
  <p>Select a goal and we’ll guide you.</p>

  <div class="goals">
    <button data-goal="appointment">Prepare for an appointment</button>
    <button data-goal="symptoms">Log or explain my symptoms</button>
    <button data-goal="notes">Review visit notes for mistakes or bias</button>
    <button data-goal="second-opinion">Request a second opinion</button>
    <button data-goal="tests">Understand test results</button>
    <small class="hint">You’ll be routed to the right workflow automatically.</small>
  </div>

  <script type="module">
    import {
      setGlobalHandoff,
      registerCopilotIngest,
      copilotIngest
    } from "/lib/briefmeSave.js";

    // 1) CoPilot on for this page (the “hub”)
    registerCopilotIngest({ enabled: true, defaultTool: "hub" });

    // 2) Log that the page was opened
    copilotIngest("page_open", "hub", { path: location.pathname });

    // 3) Map goals -> destination tools (kept behind the scenes)
    const toolMap = {
      appointment: "/BriefMe/AppointmentPlanner/",
      symptoms: "/SymptomPro/",
      notes: "/ResetPro/",              // adjust to your actual page
      "second-opinion": "/PromptPro/",  // or a dedicated SecondOpinion page
      tests: "/TrendTrack/"             // or a LabExplainer when you add it
    };

    // 4) Wire goal clicks: log -> stash goal -> navigate
    document.querySelectorAll(".goals button").forEach(btn => {
      btn.addEventListener("click", async () => {
        const goal = btn.dataset.goal;

        // Telemetry: which goal was clicked
        copilotIngest("goal_click", "hub", { goal });

        // Save context for the next page (optional prefill/UX)
        setGlobalHandoff({ goal });

        // Navigate
        location.href = toolMap[goal] || "/";
      });
    });
  </script>
</body>
</html>